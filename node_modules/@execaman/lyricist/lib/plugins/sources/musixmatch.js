"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.musixmatch_com = void 0;
const axios_1 = require("axios");
const cheerio_1 = require("cheerio");
async function musixmatch_com(url, userAgent) {
    try {
        const { data } = await (0, axios_1.get)(url, {
            headers: {
                "User-Agent": userAgent
            }
        });
        const $ = (0, cheerio_1.load)(data);
        const lyrics = [];
        const writer = /writer\(s\):/gi;
        $("div:has(h2:icontains(lyrics)):last > div").each((index, element) => {
            if (writer.test($(element).text())) {
                return false;
            }
            const tag = $(element).find("h3:first").text().trim();
            if (tag.length !== 0) {
                let lyric = `[${tag}]\n`;
                element.children.shift();
                $(element)
                    .find("div[dir=auto]")
                    .each((i, el) => {
                    lyric += $(el).text().trim().concat("\n");
                });
                if (lyric.length - tag.length === 3) {
                    throw null;
                }
                lyrics.push(lyric);
            }
            else {
                element.children.forEach((child) => {
                    let lyric = "";
                    $(child)
                        .find("div[dir=auto]")
                        .each((i, el) => {
                        lyric += $(el).text().trim().concat("\n");
                    });
                    lyrics.push(lyric);
                });
            }
        });
        if (lyrics.length === 0) {
            throw null;
        }
        return lyrics.join("\n").trim();
    }
    catch {
        return Promise.reject();
    }
}
exports.musixmatch_com = musixmatch_com;
